<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Picture Frame - AI Photo Frame</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/frame.css') }}">
    <!-- Socket.IO client library from CDN (same as websocket.js uses) -->
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js" crossorigin="anonymous"></script>
</head>

<body style="margin: 0; padding: 0; overflow: hidden;">
    <!-- Full-screen picture frame container -->
    <div class="picture-frame" id="picture-frame">
        <!-- Home button -->
        <a href="{{ url_for('index') }}" class="fullscreen-toggle" id="home-button" title="Back to Home"
            style="right: 76px;">
            <i class="bi bi-house-fill"></i>
        </a>

        <!-- Floating Fullscreen Button -->
        <button id="fullscreen-toggle" class="fullscreen-toggle" title="Toggle Fullscreen">
            <i class="bi bi-arrows-fullscreen"></i>
        </button>

        {% if latest_image %}
        <div class="image-container load-metadata" data-filename="{{ latest_image.filename }}"
            data-subfolder="{{ latest_image.subfolder }}" data-media-type="{{ latest_image.media_type }}">
            {% if latest_image.media_type == 'video' %}
            <video src="{{ url_for('serve_image', filename=latest_image.subfolder + '/' + latest_image.filename) }}"
                id="frame-image" controls preload="metadata" autoplay loop playsinline webkit-playsinline></video>
            {% else %}
            <img src="{{ url_for('serve_image', filename=latest_image.subfolder + '/' + latest_image.filename) }}"
                alt="Latest Image" id="frame-image">
            {% endif %}
            <div class="metadata">
                {% if latest_image.metadata %}
                {% if latest_image.metadata.prompt %}
                <p><strong>Prompt:</strong> {{ latest_image.metadata.prompt }}</p>
                {% endif %}
                {% if latest_image.metadata.seed %}
                <p><strong>Seed:</strong> {{ latest_image.metadata.seed }}</p>
                {% endif %}
                {% if latest_image.metadata.model %}
                <p><strong>Model:</strong> {{ latest_image.metadata.model }}</p>
                {% endif %}
                {% if latest_image.metadata.dimensions %}
                <p><strong>Dimensions:</strong> {{ latest_image.metadata.dimensions }}</p>
                {% endif %}
                {% if latest_image.metadata.date_time %}
                <p><strong>Created:</strong> {{ latest_image.metadata.date_time }}</p>
                {% endif %}
                {% if latest_image.subfolder %}
                <p><strong>Folder:</strong> {{ latest_image.subfolder }}</p>
                {% endif %}
                {% endif %}
            </div>
        </div>
        {% else %}
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh;">
            <div class="alert alert-info">No images found</div>
        </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/fullscreen.js') }}"></script>
    <!-- Shared metadata utilities -->
    <script src="{{ url_for('static', filename='js/metadata_utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/frame.js') }}"></script>

    <!-- Fullscreen toggle -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const fullscreenToggle = document.getElementById('fullscreen-toggle');
            const pictureFrame = document.getElementById('picture-frame');

            if (fullscreenToggle && pictureFrame && typeof fullscreenAPI !== 'undefined') {
                function updateFullscreenButton() {
                    if (fullscreenAPI.isFullscreen()) {
                        fullscreenToggle.innerHTML = '<i class="bi bi-fullscreen-exit"></i>';
                        fullscreenToggle.title = 'Exit Fullscreen';
                    } else {
                        fullscreenToggle.innerHTML = '<i class="bi bi-arrows-fullscreen"></i>';
                        fullscreenToggle.title = 'Enter Fullscreen';
                    }
                }

                fullscreenToggle.addEventListener('click', function () {
                    if (fullscreenAPI.isFullscreen()) {
                        fullscreenAPI.exit();
                    } else {
                        fullscreenAPI.enter(document.documentElement);
                    }
                });

                document.addEventListener('fullscreenchange', updateFullscreenButton);
                document.addEventListener('mozfullscreenchange', updateFullscreenButton);
                document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
                document.addEventListener('msfullscreenchange', updateFullscreenButton);
            }
        });
    </script>
</body>

</html>